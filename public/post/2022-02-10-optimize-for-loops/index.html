<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Timing Execution to Help Optimize for Loops</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	===================<br>
	== <a href="/">Nathan&#39;s Blog</a> ==<br>
	===================
	<div style="float: right;">infrequent posts about things I am working on</div><br>
	<p>
	<nav>
			<a href="/"><b>Home</b></a>.
			
			
			<a href="/family-culture/"><b>Family Culture</b></a>.
			
			<a href="/event/"><b>Events</b></a>.
			
			<a href="/post/"><b>Posts</b></a>.
			
			<a href="/categories/"><b>Categories</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
			<a href="/about/"><b>About</b></a>.
			
		  <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
	      <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
          <div id="search" className="mt-6"></div>
          <script>
              window.addEventListener('DOMContentLoaded', (event) => {
                  new PagefindUI({element: "#search", showSubResults: true})
              });
          </script>
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>Timing Execution to Help Optimize for Loops</h1>
			<b><time>10.02.2022 22:03</time></b>
		       
		           <a href="/tags/python">python</a>
        	       
		           <a href="/tags/optimization">optimization</a>
        	       

			<div>
				<p>I was working on optimizing some code that contained a series of loops. I began my analysis by running a few different versions of the program and timing each execution. The results were enlightening! I decided to share the approach with my team along with an <a href="https://www.python.org/doc/essays/list2str/">essay on the topic</a> by <a href="https://gvanrossum.github.io/">Guido Van Rossem</a>.</p>
<ul>
<li>
<p>General Rules of Thumb by Which to Develop Loops</p>
<ul>
<li>
<ol>
<li>Never optimize before you have proven a speed bottleneck exists. Then, only optimize the innermost loop. If you have a bunch of loops, consider breaking the function apart.</li>
</ol>
</li>
<li>
<ol start="2">
<li>Python incurs significant lookup charges for bytecode instructions and variable lookup, it rarely improves code to add extra conditionals/checks to a function to save a little work e.g. handling known scenarios with unpythonic case-like statements.</li>
</ol>
</li>
<li>
<ol start="3">
<li>Use intrinsic operations. An implied loop in <code>map()</code> is faster than an explicit for loop; An explicit for loop is faster than a while loop with a loop counter.</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>
<figure>
  <img src="/daniele-franchi-WyJ0rahs_2k-unsplash.jpg" alt="Photo by Daniele Franchi on Unsplash" />
</figure>


</p>
<h3 id="timing-programs">Timing Programs</h3>
<p>Timing can help identify speed bottlenecks by comparing execution time between different approaches to the same task.
For timing small snippets of code use <a href="https://docs.python.org/3/library/timeit.html?highlight=timeit">timeit</a>.</p>
<p>For everything else there&rsquo;s, a Timing Decorator.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> wraps
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> time_ns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">timing</span>(f):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Use functools wraps to ensure the inner function handles the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function used inside the decorator appropriately. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">We want the decorator to copy over the function name, docstring, arguments list,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">etc of the inner function.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">The use of time.perf_counter() enables millisecond 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pecision from epoch, avoiding some rounding errors 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">that may occur with a Float data type.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@wraps</span>(f)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wrap</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kw):
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> range(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    ts <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>perf_counter_ns()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> r:
</span></span><span style="display:flex;"><span>        f(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kw); f(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kw); f(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kw); f(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kw); f(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kw)
</span></span><span style="display:flex;"><span>    te <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>perf_counter_ns()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;func:</span><span style="color:#e6db74">%r</span><span style="color:#e6db74"> took: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> nano sec&#39;</span> <span style="color:#f92672">%</span> \
</span></span><span style="display:flex;"><span>      (f<span style="color:#f92672">.</span>__name__, te<span style="color:#f92672">-</span>ts))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> wrap
</span></span></code></pre></div><h2 id="helpful-rules-of-thumb-for-clean-fast-loops---by-example">Helpful rules of thumb for clean, fast loops - By Example</h2>
<ul>
<li>Ask whether you can use <a href="https://docs.python.org/3.10/library/functions.html?highlight=built#map">built-in functions</a> eg <code>map</code>, <code>reduce</code>, <code>filter</code>
<ul>
<li>&ldquo;[A] map with a built-in function beats for loop, but a for loop with in-line code beats map with a lambda function!&rdquo; - <a href="https://www.python.org/doc/essays/list2str/">Source</a></li>
</ul>
</li>
<li>Use local variables wherever possible. Python accesses local variables much more efficiently than global variables.
<ul>
<li>Example using the Timing decorator from above:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gv_f1</span>(list_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> list_:
</span></span><span style="display:flex;"><span>        global_list<span style="color:#f92672">.</span>append(item)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gv_f2</span>(list_):
</span></span><span style="display:flex;"><span>    local_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> list_:
</span></span><span style="display:flex;"><span>        local_list<span style="color:#f92672">.</span>append(item)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gv_f1(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;gv_f1&#39;</span> took: <span style="color:#ae81ff">233604000</span> nano sec
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gv_f2(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;gv_f2&#39;</span> took: <span style="color:#ae81ff">154450300</span> nano sec
</span></span></code></pre></div><p>The following example demonstrates how the decorator can be used to compare various functions that loop over a list of words to replace the &lsquo;-&rsquo; character with &lsquo;&rsquo;.
The way I built a list for this example was by downloading an <a href="http://www-personal.umich.edu/~jlawler/wordlist.html">English language wordlist</a>, and then reading the contents of the file into a list.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>wordlist <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;path/to/wordlist.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>, newline<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>        l <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        wordlist<span style="color:#f92672">.</span>append(l)<span style="color:#960050;background-color:#1e0010">```</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">```</span>python
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f1</span>(list_):    
</span></span><span style="display:flex;"><span>    l_map <span style="color:#f92672">=</span> map(<span style="color:#66d9ef">lambda</span> s: s<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>), list_)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> list(l_map)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f2</span>(list_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [item<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> list_]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f3</span>(list_):
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> list_:
</span></span><span style="display:flex;"><span>        l<span style="color:#f92672">.</span>append(item<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> l
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f4</span>(list_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [item<span style="color:#f92672">.</span>translate({<span style="color:#e6db74">&#39;-&#39;</span>: <span style="color:#e6db74">&#39;&#39;</span>}) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> list_]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@timing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f5</span>(list_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, item) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> list_]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f1(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;f1&#39;</span> took: <span style="color:#ae81ff">386078600</span> nano sec
</span></span><span style="display:flex;"><span>f2(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;f2&#39;</span> took: <span style="color:#ae81ff">243369200</span> nano sec
</span></span><span style="display:flex;"><span>f3(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;f3&#39;</span> took: <span style="color:#ae81ff">306987800</span> nano sec
</span></span><span style="display:flex;"><span>f4(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;f4&#39;</span> took: <span style="color:#ae81ff">1471997300</span> nano sec
</span></span><span style="display:flex;"><span>f5(wordlist)
</span></span><span style="display:flex;"><span>func:<span style="color:#e6db74">&#39;f5&#39;</span> took: <span style="color:#ae81ff">1957422600</span> nano sec
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Getting comfortable with timing techniques will help you feel more confident in the code you write. Execution time provides one input when optimizing functions. Remember to only optimize when you know there is a problem and defer optimizing until the code is working and stable.</p>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/post/2025-03-28-family-technology-use/">Family Technology Use</a></li>
				
				<li><a href="/post/2022-02-10-optimize-for-loops/">Timing Execution to Help Optimize for Loops</a></li>
				
				<li><a href="/post/2021-12-30-file-like-objects-in-lambda/">Working With File Like Objects in Lambda</a></li>
				
				<li><a href="/post/2021-08-31-upload-pandas-df-to-s3/">Upload a Pandas Dataframe to AWS S3 With Ease</a></li>
				
				<li><a href="/post/2021-08-16-moving-my-blog-to-hugo/">Moving My Personal Blog From Wordpress to Hugo</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2025 <a href="/"><b>Nathan&#39;s Blog</b></a>.
	<a href="https://github.com/nmaynes"><b>Github</b></a>.
	<a href="https://twitter.com/nathanmaynes"><b>Twitter</b></a>.
	</p>
</footer>

</body>
</html>
